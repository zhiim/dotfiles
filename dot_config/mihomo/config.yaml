# +----------------------------------------------------------+
# |                         ä»£ç†é…ç½®                         |
# +----------------------------------------------------------+

# å¯ä»¥æ·»åŠ å•ä¸ªä»£ç†æœåŠ¡å™¨
proxies:
  - name: "ğŸ¯ ç›´è¿"
    type: direct
    udp: true

# provider é”šç‚¹
p: &p
  type: http
  interval: 21600
  health-check:
    enable: true
    url: https://www.google.com/generate_204
    interval: 3600

# url é‡Œå¡«å†™è‡ªå·±çš„è®¢é˜…,åç§°ä¸èƒ½é‡å¤
proxy-providers:
  main:
    <<: *p
    url: ""
  fallback1:
    <<: *p
    url: ""
    override:
      additional-prefix: "[å¤‡]"
  fallback2:
    <<: *p
    url: ""
    override:
      additional-prefix: "[è‡ª]"

# +----------------------------------------------------------+
# |                      Clash åŸºç¡€è®¾ç½®                      |
# +----------------------------------------------------------+

allow-lan: true
mode: rule
log-level: info
ipv6: true
external-controller: 127.0.0.1:9090
external-ui: ui # å‰ç«¯è·¯å¾„ /path/to/clash/config/ui
external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"
unified-delay: true # è®¡ç®—å»¶è¿Ÿæ—¶æ˜¯å¦å»é™¤æ¡æ‰‹ç­‰é¢å¤–å¼€é”€
profile: # ç¼“å­˜é…ç½®
  store-selected: true # ä¿å­˜ API æ§åˆ¶çš„æ›´æ”¹
  store-fake-ip: true # ä¿å­˜ fake-ip æ˜ å°„è¡¨
tcp-concurrent: true
geodata-mode: true # geo é…ç½®
geox-url: # è‡ªå®šä¹‰GEOä¸‹è½½åœ°å€, å¯ç”¨cdnåŠ é€Ÿä¸‹è½½
  geoip: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"
  asn: "https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb"
find-process-mode: strict
global-client-fingerprint: chrome

# +----------------------------------------------------------+
# |                         DNS è®¾ç½®                         |
# +----------------------------------------------------------+

dns:
  enable: true
  prefer-h3: true # DOH åå¥½ HTTP/3
  listen: 0.0.0.0:1053
  ipv6: true # å¦‚æœéœ€è¦ä½¿ç”¨ box for magisk çš„çƒ­ç‚¹å…±äº«ä»£ç†ï¼Œéœ€è¦è®¾ç½®ä¸º false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16 # clash ä»¥æ­¤ IP æ®µå‘é€ fake-ip æ˜ å°„
  fake-ip-filter: # ä»¥ä¸‹åœ°å€ä¸ä½¿ç”¨ fake-ip
    - "+.lan"
    - "+.local"
  default-nameserver: # ç”¨äºè§£æ DNS æœåŠ¡å™¨, å¿…é¡»ä¸º IP ä¸”å¯è®¿é—®
    - 223.5.5.5
    - 119.29.29.29
  proxy-server-nameserver: # ç”¨äºè§£æä»£ç†èŠ‚ç‚¹çš„åŸŸå
    - 223.5.5.5
    - 119.29.29.29
  nameserver-policy: # æ‰‹åŠ¨è®¾å®šåŸŸåè§£æè§„åˆ™ï¼Œä¼˜å…ˆçº§é«˜äº nameserver/fallback
    "geosite:cn,private": # å›½å†…åŸŸåä½¿ç”¨å›½å†… DNS åŠ é€Ÿè§£æ
      - 223.5.5.5
      - 119.29.29.29
  nameserver: # é»˜è®¤åŸŸåè§£æï¼Œé˜²æ­¢æµ·å¤–åŸŸåè§£æè¯·æ±‚å‘é€å›½å†… DNS æœåŠ¡å™¨
    # - https://xxx.cloudflare-gateway.com/dns-query # å¯ä¿¡çš„ doh
    - https://8.8.8.8/dns-query
    - https://1.1.1.1/dns-query

# +----------------------------------------------------------+
# |       åŸŸåå—…æ¢ï¼Œä»æµé‡ä¸­è·å–åŸŸåï¼Œä»è€Œä½¿ç”¨åŸŸåè§„åˆ™       |
# +----------------------------------------------------------+

sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true # ä½¿ç”¨å—…æ¢å‡ºçš„åŸŸåï¼Œä»è€Œå¥—ç”¨åŸŸåè§„åˆ™
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"

# +----------------------------------------------------------+
# |                         å…¥ç«™é…ç½®                         |
# +----------------------------------------------------------+

mixed-port: 7890
# redir-port: 9797 # box for magisk éœ€è¦è¿™ä¸¤ä¸ªç«¯å£
# tproxy-port: 9898

## tunèµ‹æƒ  ##
# Linux: sudo setcap cap_net_bind_service,cap_net_admin=+ep /path/to/clash
# ref: https://github.com/zzzgydi/clash-verge/issues/182
#
# Windows: ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
tun:
  enable: false # é»˜è®¤å…³é—­
  device: clash_tun
  inet6-address:
  stack: mixed
  dns-hijack:
    - "any:53"
  auto-route: true
  auto-detect-interface: true

# +----------------------------------------------------------+
# |                         ä»£ç†åˆ†ç»„                         |
# +----------------------------------------------------------+

FilterHK: &FilterHK "^(?=.*(?i)(æ¸¯|ğŸ‡­ğŸ‡°|HK|Hong|HKG)).*$"
FilterSG: &FilterSG "^(?=.*(?i)(å¡|ğŸ‡¸ğŸ‡¬|SG|Sing|SIN|XSP)).*$"
FilterJP: &FilterJP "^(?=.*(?i)(æ—¥|ğŸ‡¯ğŸ‡µ|JP|Japan|NRT|HND|KIX|CTS|FUK)).*$"
FilterKR: &FilterKR "^(?=.*(?i)(éŸ©|ğŸ‡°ğŸ‡·|éŸ“|é¦–å°”|å—æœé²œ|KR|KOR|Korea|South)).*$"
FilterUS: &FilterUS "^(?=.*(?i)(ç¾|ğŸ‡ºğŸ‡¸|US|USA|SJC|JFK|LAX|ORD|ATL|DFW|SFO|MIA|SEA|IAD)).*$"
FilterTW: &FilterTW "^(?=.*(?i)(å°|ğŸ‡¼ğŸ‡¸|ğŸ‡¹ğŸ‡¼|TW|tai|TPE|TSA|KHH)).*$"
FilterOT: &FilterOT "^(?!.*(æ¸¯|ğŸ‡­ğŸ‡°|HK|Hong|HKG|å¡|ğŸ‡¸ğŸ‡¬|SG|Sing|SIN|XSP|æ—¥|ğŸ‡¯ğŸ‡µ|JP|Japan|NRT|HND|KIX|CTS|FUK|éŸ©|ğŸ‡°ğŸ‡·|éŸ“|é¦–å°”|å—æœé²œ|KR|KOR|Korea|South|ç¾|ğŸ‡ºğŸ‡¸|US|USA|SJC|JFK|LAX|ORD|ATL|DFW|SFO|MIA|SEA|IAD|å°|ğŸ‡¼ğŸ‡¸|ğŸ‡¹ğŸ‡¼|TW|tai|TPE|TSA|KHH)).*$"

Exclude: &Exclude '^(\[å¤‡\]|\[è‡ª\]).*$'

auto: &auto
  type: fallback
  interval: 200
  lazy: true
  url: "https://www.google.com/generate_204"
  hidden: true

default: &default
  type: select
  proxies:
    - ğŸ¥¤ é»˜è®¤
    - ğŸ‡­ğŸ‡° é¦™æ¸¯
    - ğŸ‡¹ğŸ‡¼ å°æ¹¾
    - ğŸ‡¯ğŸ‡µ æ—¥æœ¬
    - ğŸ‡°ğŸ‡· éŸ©å›½
    - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡
    - ğŸ‡ºğŸ‡¸ ç¾å›½
    - ğŸŒ å…¶å®ƒåœ°åŒº
    - ğŸ¯ ç›´è¿
    - ğŸš€ å…¨éƒ¨èŠ‚ç‚¹
    - â™» è‡ªåŠ¨é€‰æ‹©
direct: &direct
  type: select
  proxies:
    - ğŸ¯ ç›´è¿
    - ğŸ¥¤ é»˜è®¤
    - ğŸ‡­ğŸ‡° é¦™æ¸¯
    - ğŸ‡¹ğŸ‡¼ å°æ¹¾
    - ğŸ‡¯ğŸ‡µ æ—¥æœ¬
    - ğŸ‡°ğŸ‡· éŸ©å›½
    - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡
    - ğŸ‡ºğŸ‡¸ ç¾å›½
    - ğŸŒ å…¶å®ƒåœ°åŒº
    - ğŸš€ å…¨éƒ¨èŠ‚ç‚¹
    - â™» è‡ªåŠ¨é€‰æ‹©

proxy-groups:
  - name: ğŸ¥¤ é»˜è®¤
    type: select
    proxies:
      - ğŸš€ å…¨éƒ¨èŠ‚ç‚¹
      - â™» è‡ªåŠ¨é€‰æ‹©
      - ğŸ¯ ç›´è¿
      - ğŸ‡­ğŸ‡° é¦™æ¸¯
      - ğŸ‡¹ğŸ‡¼ å°æ¹¾
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬
      - ğŸ‡°ğŸ‡· éŸ©å›½
      - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡
      - ğŸ‡ºğŸ‡¸ ç¾å›½
      - ğŸŒ å…¶å®ƒåœ°åŒº

  - name: ğŸš€ å…¨éƒ¨èŠ‚ç‚¹
    type: select
    proxies:
      - âœˆï¸ ä¸»è®¢é˜…
      - ğŸ›©ï¸ å¤‡ç”¨è®¢é˜…
      - ğŸ›©ï¸ è‡ªå»ºè®¢é˜…
  - name: âœˆï¸ ä¸»è®¢é˜…
    type: select
    exclude-filter: *Exclude
    include-all-providers: true
  - name: ğŸ›©ï¸ å¤‡ç”¨è®¢é˜…
    type: select
    filter: '^\[å¤‡\].*$'
    include-all-providers: true
  - name: ğŸ›©ï¸ è‡ªå»ºè®¢é˜…
    type: select
    filter: '^\[è‡ª\].*$'
    include-all: true

  - name: â™» è‡ªåŠ¨é€‰æ‹©
    type: url-test
    exclude-filter: *Exclude
    include-all-providers: true
    tolerance: 10

  - name: ğŸ‡­ğŸ‡° é¦™æ¸¯
    type: select
    filter: *FilterHK
    exclude-filter: *Exclude
    include-all-providers: true
  - name: ğŸ‡¹ğŸ‡¼ å°æ¹¾
    type: select
    filter: *FilterTW
    exclude-filter: *Exclude
    include-all-providers: true
  - name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬
    type: select
    filter: *FilterJP
    exclude-filter: *Exclude
    include-all-providers: true
  - name: ğŸ‡°ğŸ‡· éŸ©å›½
    type: select
    filter: *FilterKR
    exclude-filter: *Exclude
    include-all-providers: true
  - name: ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡
    type: select
    filter: *FilterSG
    exclude-filter: *Exclude
    include-all-providers: true
  - name: ğŸ‡ºğŸ‡¸ ç¾å›½
    type: select
    filter: *FilterUS
    exclude-filter: *Exclude
    include-all-providers: true
  - name: ğŸŒ å…¶å®ƒåœ°åŒº
    type: select
    filter: *FilterOT
    exclude-filter: *Exclude
    include-all-providers: true

  - name: ğŸ® Github
    <<: *default
  - name: ğŸ¥› Spotify
    <<: *default
  - name: ğŸ«™ Microsoft
    <<: *default
  - name: ğŸ§Š Google
    <<: *default
  - name: ğŸ­ Telegram
    <<: *default
  - name: ğŸ§‹ YouTube
    <<: *default
  - name: ğŸ¡ Tracker
    <<: *direct
  - name: â­ å…¶ä»–éå¤§é™†
    <<: *default
  - name: ğŸ‡¨ğŸ‡³ å›½å†…
    <<: *direct
  - name: ğŸ“¢ è°·æ­ŒFCM
    <<: *direct
  - name: ğŸŸ æ¼ç½‘ä¹‹é±¼
    <<: *default

# +----------------------------------------------------------+
# |                         è§„åˆ™åˆ†æµ                         |
# +----------------------------------------------------------+

rules:
  # åŸŸåè§„åˆ™
  - GEOIP,lan,ğŸ¯ ç›´è¿,no-resolve
  - RULE-SET,direct_list,ğŸ‡¨ğŸ‡³ å›½å†…
  - RULE-SET,blacklist,REJECT
  - RULE-SET,google_fcm,ğŸ“¢ è°·æ­ŒFCM
  - RULE-SET,github_domain,ğŸ® Github
  - RULE-SET,spotify_domain,ğŸ¥› Spotify
  - RULE-SET,microsoft_domain,ğŸ«™ Microsoft
  - RULE-SET,google_domain,ğŸ§Š Google
  - RULE-SET,telegram_domain,ğŸ­ Telegram
  - RULE-SET,youtube_domain,ğŸ§‹ YouTube
  - RULE-SET,tracker_domain,ğŸ¡ Tracker
  - RULE-SET,qiufen_ad_doamin,REJECT
  - RULE-SET,category_porn_domain,REJECT
  - RULE-SET,porn_domain,REJECT
  - RULE-SET,cn_domain,ğŸ‡¨ğŸ‡³ å›½å†…
  - RULE-SET,geolocation-!cn,â­ å…¶ä»–éå¤§é™†

  # IPè§„åˆ™, å¦‚æœåŸŸåè§„åˆ™ä¸åŒ¹é…åˆ™è¿›å…¥IPè§„åˆ™, æ­¤æ—¶ä¼šä½¿ç”¨Clashé…ç½®çš„DNSè§„åˆ™è§£æIP
  - RULE-SET,google_ip,ğŸ§Š Google
  - RULE-SET,telegram_ip,ğŸ­ Telegram
  - RULE-SET,cn_ip,ğŸ‡¨ğŸ‡³ å›½å†…

  # æœªåŒ¹é…å…œåº•
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼

# +----------------------------------------------------------+
# |                          è§„åˆ™é›†                          |
# +----------------------------------------------------------+

# IP è§„åˆ™é›†
ip: &ip
  type: http
  interval: 86400
  behavior: ipcidr
  format: yaml
mrs: &mrs
  type: http
  interval: 86400
  behavior: domain
  format: mrs
# åŸŸåè§„åˆ™é›†
domain: &domain
  type: http
  interval: 86400
  behavior: domain
  format: yaml
mrsip: &mrsip
  type: http
  interval: 86400
  behavior: ipcidr
  format: mrs

rule-providers:
  github_domain:
    <<: *mrs
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/github.mrs"
  spotify_domain:
    <<: *mrs
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/spotify.mrs"
  microsoft_domain:
    <<: *mrs
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/microsoft.mrs"
  google_domain:
    <<: *mrs
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.mrs"
  youtube_domain:
    <<: *mrs
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/youtube.mrs"
  telegram_domain:
    <<: *mrs
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/telegram.mrs"
  tracker_domain:
    <<: *mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/tracker.mrs"
  geolocation-!cn:
    <<: *mrs
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.mrs"
  qiufen_ad_doamin:
    <<: *domain
    url: "https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main//Filters/AWAvenue-Ads-Rule-Clash.yaml"
  category_porn_domain:
    <<: *mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/category-porn.mrs"
  porn_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/1stfine/open_clash/master/rule_provider/rule_porn.yaml"
  cn_domain:
    <<: *mrs
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.mrs"

  google_ip:
    <<: *mrsip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/google.mrs"
  telegram_ip:
    <<: *mrsip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/telegram.mrs"
  cn_ip:
    <<: *mrsip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.mrs"

  google_fcm:
    url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/refs/heads/master/Clash/Ruleset/GoogleFCM.list"
    behavior: classical
    interval: 86400
    format: text
    type: http

  # è‡ªå®šä¹‰è§„åˆ™
  blacklist:
    type: inline
    behavior: classical
    payload:
      - DOMAIN-KEYWORD,porn
      - DOMAIN-KEYWORD,jav
      - DOMAIN-KEYWORD,missav
      - DOMAIN-KEYWORD,sex
      - DOMAIN-KEYWORD,xvideos
      - DOMAIN-SUFFIX,madou.club
      - DOMAIN-SUFFIX,wnacg.org
      - DOMAIN-SUFFIX,xhamster.com
      - DOMAIN-SUFFIX,xnxx.com
      - DOMAIN-SUFFIX,rou.video
      - DOMAIN-KEYWORD,91cg
      - DOMAIN-KEYWORD,51cg
      - DOMAIN-KEYWORD,cg51
      - DOMAIN-KEYWORD,cg91
      - DOMAIN-KEYWORD,cgw
      - DOMAIN-KEYWORD,51gua
      - DOMAIN-KEYWORD,91gua
      - DOMAIN-KEYWORD,gua51
      - DOMAIN-KEYWORD,gua91
      - DOMAIN-KEYWORD,mrds
      - DOMAIN-KEYWORD,baoliao
      - DOMAIN-KEYWORD,awcg
      - DOMAIN-KEYWORD,cigua
      - DOMAIN-KEYWORD,cgwang
      - DOMAIN-KEYWORD,52cg
      - DOMAIN-KEYWORD,airav
      - DOMAIN-KEYWORD,xmorex
      - DOMAIN-KEYWORD,xszav
      - DOMAIN-KEYWORD,videocelebs
  direct_list:
    type: inline
    behavior: classical
    payload:
      # ä¸ºç‰¹å®šè¿›ç¨‹è®¾ç½®ç›´è¿
      # - PROCESS-PATH,/usr/bin/linuxqq
      # - PROCESS-PATH-REGEX,\/tmp\/\.mount_linux.*\/qq
      # - PROCESS-PATH,/opt/wechat-appimage/wechat-appimage.AppImage
      # - PROCESS-PATH-REGEX,\/tmp\/\.mount_wechat.*wechat.*
